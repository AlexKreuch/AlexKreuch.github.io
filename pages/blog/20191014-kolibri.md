# Run Planet and Kolibri

18, November 2019 â€¢ [irisb1701](https://github.com/irisb1701)

---

Kolibri is a platform used by our "competitor" organization called Learning Equality similar to what Planet is for Open Learning Exchange.

Below are instructions on how to run Kolibri on treehouses:

## Run Kolibri using Autorunonce
The steps described below will show you how to modify the `autorunonce` file to create a docker container so that Kolibri is pre-installed and ready to go as soon as you boot your new image. This method is the exact same way we use Docker and YAML files to view planet.

1. Flash a new treehouses image.
2. Before booting the image, go to the boot folder (SD card/boot partition) and open the `autorunonce` file
    - As you may know, the `autorunonce` file will execute one time (when you first ssh into treehouses) and then will become `autoRANonce`. That way, every time you access the image, everything executed in the `autorunonce` the first time will remain configured and will not be re-executed
3. Make the following changes to the `autorunonce` file
    - This is optional, however you can cmd/ctrl + F for the phrase 'start planet' and replace it with 'start services' since we are running both planet and Kolibri now instead of just planet.
    - Set up your internet login settings.
    - ``` 
          connectiontype="wifi"
          
          wifiname='YourWifiName'
          wifipassword='YourWifiPassword'
      ```
    - Include port 8080 in Tor which we will use for Kolibri.
    - ```bash 
        if [ $starttor = "true" ]; then
          treehouses tor add 22
          if [ $startservices = "true" ]; then
            treehouses tor add 80
            treehouses tor add 2200
            treehouses tor add 8080 <--- add here
          fi   
      ```
    - Scroll to where the autorun file is being created and add the following command.
    - ```bash
       {
         echo "#!/bin/sh"
         echo
         echo "if [ \"$(treehouses container)\" = \"balena\" ]; then"
         echo "  export DOCKER_HOST=localhost:2375"
         echo "fi"
         echo "sleep 1"
         echo
         echo "if [ -f /srv/planet/pwd/credentials.yml ]; then"
         echo "  docker-compose -f /srv/planet/planet.yml -f /srv/planet/volumes.yml -f /srv/planet/pwd/credentials.yml -p planet up -d"
         echo "else"
         echo "  docker-compose -f /srv/planet/planet.yml -f /srv/planet/volumes.yml -p planet up -d"
         echo "fi"
         echo
         echo "docker-compose -f /boot/kolibri.yml -p kolibri up -d" <--- add this line here
       } > /boot/autorun  
         ```
         - For context, the autorun file is being created by the `> /boot/autorun` command and placed in our boot folder. This is why after booting your image for the first time, you will see in your boot file `autorunonce` has turned into `autoranonce`, and directly below is a new file called `autorun`. This file, unlike autorunonce, executes every time treehouses is booted and can be modified and re-executed multiple times.
1. This new line `echo "docker-compose -f /boot/kolibri.yml -p kolibri up -d"` will create a Docker container for Kolibri using a Kolibri YAML file.
2. To create our kolibri.yml file we will open a new file in our IDE and include the following lines.
```yaml
services:
    kolibri:
      image: treehouses/kolibri
      ports:
        - "8080:8080"
      volumes:
        - "/srv/kolibri:/root/.kolibri"
version: "2"
```
1. In this file it is important that we define the port `8080` that we can view Kolibri on and the volume, or where Kolibri will be retrieved from `/srv/kolibri:/root/.kolibri`
2. Save this file as kolibri.yml and place it inside your boot folder.
3. Now when you run your new image and ssh into treehouses, a Kolibri container will automatically be created.
4. If you run the command `docker ps` you will see the current running Docker containers and the ports they can be viewed on.
5. You will see our 2 containers, planet and CouchDB on ports 80 and 2200 respectively.
6. If you enter your RPi's IP address followed by a colon and these ports on a browser you can view the containers, ie. `192.168.1.8:2200`
7. Unlike these 2 containers which Dogi has already pre-installed and can be viewed automatically, Kolibri will only appear once you have rebooted treehouses.
8. After allowing Kolibri 5 minutes or so to internally complete its installation, perform a reboot and run `docker ps` once again. 
9. You will now see the Kolibri container.
10. View Kolibri on port 8080 of your browser.


## Run Kolibri Manually
Another way to run Kolibri is to do it manually using Docker commands which can be done using the following steps:

1. Plug your RPi in and ssh into treehouses.
2. If you don't already have Docker installed, follow [these instructions](https://docs.docker.com/v17.09/engine/installation/) on their official page to install it on mac/windows/linux.
3. Run the following command in your terminal:
    - `docker run -v /srv/kolibri:/root/.kolibri -p 8080:8080 treehouses/kolibri`
    - This command can be found on [treehouses github](https://github.com/treehouses) in the `kolibri` repository inside the README.md
    - The change we made is replacing `/data/save/location` with `/srv/kolibri`
4. Now a Kolibri container is being created, which will take a few moments.
5. Enter your RPi IP address in your browser followed by :8080, Example: `192.168.1.8:8080`
6. You should now see the Kolibri interface.
   ![](images/20191014-kolibri-home.png)

## Congrats, you've successfully run Kolibri on treehouses

1. You can create an account and browse around, you will see it is not very different from planet learning.
2. You can import learning materials the same way you would in the planet.
   ![](images/20191014-kolibri-import.png)
3. You can pull up planet on your browser as well by entering just the IP address of your RPi in another browser.
   ![](images/20191014-planet.png)
4. Now you have successfully ran Kolibri on treehouses and can compare and contrast it with planet.

---

If you want to make sure you are using the latest version of Kolibri you can check like this:

1. Go to hub.docker.com
2. Search for treehouses/kolibri (2nd result)
3. Select it, then select tags
4. ![](images/20191014-docker.png)
5. View the last updated version and cross-check by googling Kolibri's current version.
